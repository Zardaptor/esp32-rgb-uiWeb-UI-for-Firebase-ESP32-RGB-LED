<body>
  <h1>ESP32 RGB Controller</h1>
  <p id="espStatus">ESP32 Status: ⏳ Checking...</p>
  <div class="color-preview" id="colorBox"></div>

  <div class="slider-row">
    <label for="r">Red</label>
    <input type="range" min="0" max="255" id="r" value="0">
    <div class="value" id="rVal">0</div>
  </div>

  <div class="slider-row">
    <label for="g">Green</label>
    <input type="range" min="0" max="255" id="g" value="0">
    <div class="value" id="gVal">0</div>
  </div>

  <div class="slider-row">
    <label for="b">Blue</label>
    <input type="range" min="0" max="255" id="b" value="0">
    <div class="value" id="bVal">0</div>
  </div>

  <button onclick="sendColor()">Set Color</button>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: "",  // ✅ Fill this
      authDomain: "esp32ledsk.firebaseapp.com",
      databaseURL: "https://esp32ledsk-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "esp32ledsk",
      storageBucket: "esp32ledsk.appspot.com",
      messagingSenderId: "", // ✅ Optional
      appId: ""               // ✅ Optional
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const rSlider = document.getElementById('r');
    const gSlider = document.getElementById('g');
    const bSlider = document.getElementById('b');
    const statusText = document.getElementById('espStatus');

    function updatePreview() {
      const r = rSlider.value;
      const g = gSlider.value;
      const b = bSlider.value;
      document.getElementById('colorBox').style.backgroundColor = `rgb(${r},${g},${b})`;
      document.getElementById('rVal').textContent = r;
      document.getElementById('gVal').textContent = g;
      document.getElementById('bVal').textContent = b;
    }

    rSlider.addEventListener('input', updatePreview);
    gSlider.addEventListener('input', updatePreview);
    bSlider.addEventListener('input', updatePreview);

    function sendColor() {
      const r = parseInt(rSlider.value);
      const g = parseInt(gSlider.value);
      const b = parseInt(bSlider.value);
      set(ref(db, 'led'), { r, g, b });
    }

    // Listen for ESP32 connection status
    onValue(ref(db, 'status/connected'), (snapshot) => {
      const connected = snapshot.val();
      if (connected === true) {
        statusText.textContent = "ESP32 Status: 🟢 Connected";
      } else {
        statusText.textContent = "ESP32 Status: 🔴 Disconnected";
      }
    });

    updatePreview();
  </script>
</body>
